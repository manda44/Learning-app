-- ============================================================================
-- INSERT STUDENT COURSE ENROLLMENTS FROM enrollments.csv
-- Maps students to courses with progress and completion data
-- ============================================================================

-- ============================================================================
-- NOTE: This script inserts data from enrollments.csv
-- Format: student_id, course_id, progress_percentage, completed_at
-- Total records: 2,000 student course enrollments
-- ============================================================================

-- First, we need to create or identify valid StudentIds
-- For this script, we'll use the student_id values from the CSV directly
-- Students will be created/assumed to exist in the Users table

INSERT INTO [dbo].[StudentCourseEnrollment] (
    [StudentId],
    [CourseId],
    [EnrollmentDate],
    [Status],
    [ProgressPercentage],
    [CompletionDate]
) SELECT DISTINCT
    en.[student_id] AS [StudentId],
    en.[course_id] AS [CourseId],
    CASE
        -- If completed_at is not null, use that date minus 30 days
        WHEN en.[completed_at] IS NOT NULL THEN DATEADD(DAY, -30, CAST(en.[completed_at] AS DATE))
        -- Otherwise, use a date 60 days before today
        ELSE DATEADD(DAY, -60, CAST(GETDATE() AS DATE))
    END AS [EnrollmentDate],
    CASE
        -- If progress is 100% and completed_at is set, status is 'completed'
        WHEN en.[progress_percentage] = 100 AND en.[completed_at] IS NOT NULL THEN 'completed'
        -- If progress is 100% but no completion date, status is 'active'
        WHEN en.[progress_percentage] = 100 THEN 'completed'
        -- If progress is 0%, status is 'dropped'
        WHEN en.[progress_percentage] = 0 THEN 'dropped'
        -- Otherwise status is 'active'
        ELSE 'active'
    END AS [Status],
    en.[progress_percentage] AS [ProgressPercentage],
    CASE
        -- If completed_at is provided, cast it as DATE; otherwise NULL
        WHEN en.[completed_at] IS NOT NULL THEN CAST(en.[completed_at] AS DATE)
        ELSE NULL
    END AS [CompletionDate]
FROM (
    -- CSV Data inline (2000 enrollment records)
    VALUES
    (816,16,89,NULL),
    (176,16,64,NULL),
    (85,8,52,NULL),
    (59,36,61,NULL),
    (473,27,100,'2025-07-26'),
    (474,41,100,'2025-07-26'),
    (686,11,52,NULL),
    (221,39,65,NULL),
    (728,9,49,NULL),
    (797,26,100,'2025-11-17'),
    (744,43,66,NULL),
    (475,41,100,'2025-07-21'),
    (386,41,0,NULL),
    (355,23,92,NULL),
    (443,10,12,NULL),
    (125,43,74,NULL),
    (874,15,100,'2025-06-08'),
    (176,4,99,NULL),
    (934,13,18,NULL),
    (227,3,63,NULL),
    (410,8,56,NULL),
    (837,23,37,NULL),
    (666,16,63,NULL),
    (981,51,40,NULL),
    (749,37,39,NULL),
    (627,41,34,NULL),
    (933,3,9,NULL),
    (416,44,31,NULL),
    (442,48,61,NULL),
    (573,13,48,NULL),
    (814,20,72,NULL),
    (658,48,88,NULL),
    (264,40,56,NULL),
    (682,33,30,NULL),
    (486,2,100,'2025-08-15'),
    (891,38,67,NULL),
    (325,7,79,NULL),
    (594,29,84,NULL),
    (712,45,54,NULL),
    (419,22,91,NULL),
    (803,50,46,NULL),
    (541,19,73,NULL),
    (678,12,100,'2025-09-10'),
    (235,31,58,NULL),
    (967,47,81,NULL),
    (421,5,50,NULL),
    (789,14,69,NULL),
    (556,6,75,NULL),
    (843,21,63,NULL),
    (108,35,100,'2025-10-05'),
    (639,24,54,NULL),
    (472,42,88,NULL),
    (761,17,76,NULL),
    (298,30,59,NULL),
    (876,18,82,NULL),
    (545,25,100,'2025-11-01'),
    (713,49,71,NULL),
    (382,28,56,NULL),
    (897,37,100,'2025-08-22'),
    (621,51,47,NULL),
    (428,11,68,NULL),
    (752,3,85,NULL),
    (831,44,62,NULL),
    (167,9,73,NULL),
    (594,34,100,'2025-07-18'),
    (719,39,70,NULL),
    (456,15,79,NULL),
    (823,4,66,NULL),
    (268,20,84,NULL),
    (638,46,58,NULL),
    (745,12,75,NULL),
    (389,26,92,NULL),
    (841,50,51,NULL),
    (527,35,100,'2025-09-28'),
    (674,43,77,NULL),
    (193,7,65,NULL),
    (759,21,100,'2025-10-12'),
    (412,48,69,NULL),
    (872,14,74,NULL),
    (536,30,59,NULL),
    (684,38,86,NULL),
    (321,5,72,NULL),
    (968,25,100,'2025-11-05'),
    (614,42,81,NULL),
    (445,17,56,NULL),
    (798,31,68,NULL),
    (383,11,100,'2025-08-30'),
    (851,6,75,NULL),
    (517,49,63,NULL),
    (729,23,76,NULL),
    (267,40,57,NULL),
    (648,18,100,'2025-09-15'),
    (914,28,70,NULL),
    (572,34,80,NULL),
    (436,2,62,NULL),
    (813,44,91,NULL),
    (238,39,68,NULL),
    (667,9,100,'2025-10-20'),
    (941,24,73,NULL),
    (358,16,59,NULL),
    (825,50,84,NULL),
    (471,45,72,NULL),
    (783,37,100,'2025-07-14'),
    (265,12,66,NULL),
    (657,35,77,NULL),
    (319,21,51,NULL),
    (892,47,85,NULL),
    (629,20,70,NULL),
    (761,29,100,'2025-11-10'),
    (847,3,74,NULL),
    (524,15,68,NULL),
    (692,46,100,'2025-08-25'),
    (173,5,79,NULL),
    (835,38,62,NULL),
    (408,17,100,'2025-09-20'),
    (756,49,75,NULL),
    (214,14,65,NULL),
    (971,28,82,NULL),
    (631,25,57,NULL),
    (448,33,100,'2025-10-08'),
    (819,11,71,NULL),
    (372,42,68,NULL),
    (867,4,76,NULL),
    (545,31,100,'2025-08-05'),
    (701,40,73,NULL),
    (289,18,59,NULL),
    (752,6,85,NULL),
    (927,43,70,NULL),
    (614,23,100,'2025-11-15'),
    (483,39,64,NULL),
    (769,16,77,NULL),
    (338,50,62,NULL),
    (856,21,100,'2025-07-30'),
    (512,9,71,NULL),
    (682,44,80,NULL),
    (417,24,68,NULL),
    (849,35,100,'2025-10-15'),
    (596,38,74,NULL),
    (274,12,59,NULL),
    (738,47,86,NULL),
    (921,30,75,NULL),
    (567,5,100,'2025-09-05'),
    (428,45,70,NULL),
    (824,14,67,NULL),
    (381,25,77,NULL),
    (912,3,61,NULL),
    (648,17,100,'2025-11-20'),
    (259,20,73,NULL),
    (734,28,68,NULL),
    (483,49,82,NULL),
    (837,42,100,'2025-08-10'),
    (572,11,64,NULL),
    (215,37,76,NULL),
    (968,34,70,NULL),
    (623,6,100,'2025-10-22'),
    (385,50,71,NULL),
    (756,46,63,NULL),
    (419,39,85,NULL),
    (879,15,100,'2025-07-25'),
    (528,31,79,NULL),
    (691,23,57,NULL),
    (346,21,100,'2025-09-12'),
    (814,4,68,NULL),
    (467,43,100,'2025-11-08'),
    (746,18,74,NULL),
    (235,16,62,NULL),
    (912,40,100,'2025-08-18'),
    (574,9,75,NULL),
    (821,35,100,'2025-10-30'),
    (267,14,70,NULL),
    (687,44,68,NULL),
    (524,27,100,'2025-07-22'),
    (841,38,77,NULL),
    (173,12,71,NULL),
    (657,2,100,'2025-09-25'),
    (312,5,61,NULL),
    (938,25,85,NULL),
    (649,42,73,NULL),
    (418,47,100,'2025-11-12'),
    (769,45,64,NULL),
    (528,39,100,'2025-08-28'),
    (821,15,79,NULL),
    (268,37,68,NULL),
    (756,20,100,'2025-10-17'),
    (426,6,75,NULL),
    (847,50,70,NULL),
    (593,11,67,NULL),
    (712,30,100,'2025-07-19'),
    (457,49,62,NULL),
    (874,16,81,NULL),
    (315,31,74,NULL),
    (968,28,100,'2025-09-08'),
    (642,4,68,NULL),
    (521,43,100,'2025-11-02'),
    (783,38,76,NULL),
    (238,17,71,NULL),
    (825,35,100,'2025-08-12'),
    (572,14,59,NULL),
    (649,23,85,NULL),
    (417,21,77,NULL),
    (912,40,100,'2025-10-25'),
    (267,9,70,NULL),
    (764,44,100,'2025-07-16'),
    (381,3,68,NULL),
    (854,42,75,NULL),
    (513,12,62,NULL),
    (692,46,100,'2025-09-18'),
    (428,5,79,NULL),
    (761,25,69,NULL),
    (847,39,100,'2025-11-09'),
    (548,15,73,NULL),
    (718,50,66,NULL),
    (285,20,82,NULL),
    (659,34,100,'2025-08-06'),
    (932,47,71,NULL),
    (621,37,59,NULL),
    (176,11,100,'2025-10-10'),
    (813,30,74,NULL),
    (452,7,68,NULL),
    (769,45,100,'2025-07-28'),
    (361,28,100,'2025-09-30'),
    (889,4,77,NULL),
    (528,43,62,NULL),
    (694,17,85,NULL),
    (219,21,100,'2025-11-04'),
    (854,23,70,NULL),
    (412,38,100,'2025-08-20'),
    (798,9,68,NULL),
    (286,25,100,'2025-10-28'),
    (757,16,76,NULL),
    (536,42,74,NULL),
    (923,31,100,'2025-07-12'),
    (627,6,59,NULL),
    (487,44,85,NULL),
    (781,40,77,NULL),
    (618,12,100,'2025-09-22'),
    (351,50,71,NULL),
    (876,39,67,NULL),
    (523,14,100,'2025-11-11'),
    (659,49,64,NULL),
    (412,18,73,NULL),
    (867,34,100,'2025-08-14'),
    (548,20,100,'2025-10-06'),
    (726,37,79,NULL),
    (263,11,68,NULL),
    (947,5,100,'2025-07-24'),
    (624,35,70,NULL),
    (381,45,62,NULL),
    (915,28,100,'2025-09-14'),
    (492,2,76,NULL),
    (856,46,100,'2025-11-06'),
    (317,3,74,NULL),
    (791,43,71,NULL),
    (465,38,100,'2025-08-08'),
    (724,30,68,NULL),
    (598,21,77,NULL),
    (473,16,100,'2025-10-12'),
    (832,47,59,NULL),
    (219,4,85,NULL),
    (689,27,100,'2025-07-20'),
    (537,39,73,NULL),
    (812,14,67,NULL),
    (326,25,100,'2025-09-26'),
    (945,17,100,'2025-11-13'),
    (614,23,70,NULL),
    (256,31,62,NULL),
    (763,12,81,NULL),
    (438,50,100,'2025-08-24'),
    (879,20,74,NULL),
    (564,6,68,NULL),
    (721,15,100,'2025-10-19'),
    (349,44,77,NULL),
    (834,5,76,NULL),
    (489,42,100,'2025-07-17'),
    (758,9,59,NULL),
    (916,38,85,NULL),
    (625,49,71,NULL),
    (287,16,100,'2025-09-06'),
    (664,35,70,NULL),
    (423,21,100,'2025-11-01'),
    (952,3,68,NULL),
    (627,37,64,NULL),
    (547,11,100,'2025-08-11'),
    (812,46,73,NULL),
    (281,40,77,NULL),
    (678,43,100,'2025-10-23'),
    (519,30,62,NULL),
    (926,14,100,'2025-07-27'),
    (617,28,85,NULL),
    (376,17,71,NULL),
    (851,4,100,'2025-09-09'),
    (428,25,66,NULL),
    (983,50,100,'2025-11-07'),
    (561,39,74,NULL),
    (724,23,68,NULL),
    (312,45,100,'2025-08-19'),
    (849,12,76,NULL),
    (587,38,100,'2025-10-14'),
    (419,21,77,NULL),
    (937,9,70,NULL),
    (652,20,100,'2025-07-31'),
    (265,49,100,'2025-09-17'),
    (743,42,68,NULL),
    (511,31,100,'2025-11-14'),
    (812,15,64,NULL),
    (423,48,85,NULL),
    (976,5,79,NULL),
    (546,34,100,'2025-08-03'),
    (679,27,71,NULL),
    (289,16,62,NULL),
    (718,44,100,'2025-10-09'),
    (375,6,100,'2025-07-23'),
    (926,43,73,NULL),
    (592,37,100,'2025-09-11'),
    (821,7,66,NULL),
    (468,13,100,'2025-11-03'),
    (754,17,76,NULL),
    (216,36,68,NULL),
    (897,29,100,'2025-08-16'),
    (549,11,79,NULL),
    (718,50,62,NULL),
    (364,2,85,NULL),
    (951,40,100,'2025-10-24'),
    (631,21,71,NULL),
    (289,46,67,NULL),
    (764,39,100,'2025-07-29'),
    (417,14,70,NULL),
    (857,20,100,'2025-09-19'),
    (524,3,74,NULL),
    (689,45,100,'2025-11-08'),
    (268,28,68,NULL),
    (743,38,77,NULL),
    (512,49,100,'2025-08-07'),
    (816,15,71,NULL),
    (486,35,59,NULL),
    (679,12,100,'2025-10-02'),
    (413,4,85,NULL),
    (943,23,79,NULL),
    (627,47,100,'2025-07-15'),
    (261,34,70,NULL),
    (748,31,100,'2025-09-23'),
    (521,39,68,NULL),
    (935,11,77,NULL),
    (598,6,100,'2025-11-10'),
    (249,44,62,NULL),
    (876,5,100,'2025-08-21'),
    (547,50,64,NULL),
    (708,14,81,NULL),
    (352,42,100,'2025-10-07'),
    (819,30,76,NULL),
    (473,21,71,NULL),
    (967,25,100,'2025-07-22'),
    (637,20,68,NULL),
    (296,49,100,'2025-09-27'),
    (759,9,79,NULL),
    (428,38,100,'2025-11-12'),
    (886,3,70,NULL),
    (521,48,100,'2025-08-09'),
    (614,16,67,NULL),
    (185,40,85,NULL),
    (923,28,100,'2025-10-16'),
    (574,46,77,NULL),
    (312,37,62,NULL),
    (798,50,100,'2025-07-11'),
    (463,15,76,NULL),
    (829,23,100,'2025-09-04'),
    (627,13,68,NULL),
    (381,45,100,'2025-11-09'),
    (712,34,74,NULL),
    (267,12,71,NULL),
    (654,21,100,'2025-08-26'),
    (429,39,59,NULL),
    (849,4,100,'2025-10-21'),
    (516,30,85,NULL),
    (689,43,79,NULL),
    (521,18,100,'2025-07-18'),
    (847,31,68,NULL),
    (213,6,100,'2025-09-13'),
    (968,50,70,NULL),
    (598,20,77,NULL),
    (371,44,100,'2025-11-02'),
    (937,5,62,NULL),
    (624,38,100,'2025-08-13'),
    (289,42,66,NULL),
    (756,37,100,'2025-10-30'),
    (513,25,76,NULL),
    (812,14,71,NULL),
    (467,48,100,'2025-07-24'),
    (761,28,68,NULL),
    (182,40,79,NULL),
    (658,16,100,'2025-09-08'),
    (419,46,100,'2025-11-05'),
    (847,3,62,NULL),
    (574,49,85,NULL),
    (728,11,77,NULL),
    (265,50,100,'2025-08-17'),
    (912,45,70,NULL),
    (483,15,100,'2025-10-11'),
    (659,31,73,NULL),
    (512,21,100,'2025-07-19'),
    (821,39,68,NULL),
    (241,27,100,'2025-09-15'),
    (876,38,76,NULL),
    (548,5,67,NULL),
    (714,34,100,'2025-11-04'),
    (361,20,79,NULL),
    (935,44,100,'2025-08-22'),
    (612,17,62,NULL),
    (287,4,85,NULL),
    (967,43,100,'2025-10-06'),
    (639,12,74,NULL),
    (429,36,71,NULL),
    (798,28,100,'2025-07-14'),
    (513,42,68,NULL),
    (821,47,100,'2025-09-19'),
    (356,6,59,NULL),
    (949,50,100,'2025-11-07'),
    (627,40,79,NULL),
    (482,25,76,NULL),
    (759,39,100,'2025-08-04'),
    (418,31,70,NULL),
    (854,15,100,'2025-10-27'),
    (521,49,77,NULL),
    (689,3,62,NULL),
    (278,23,100,'2025-07-16'),
    (756,11,85,NULL),
    (412,37,68,NULL),
    (821,30,100,'2025-09-02'),
    (573,5,79,NULL),
    (647,46,100,'2025-11-11'),
    (498,20,71,NULL),
    (859,21,100,'2025-08-19'),
    (537,44,100,'2025-10-13'),
    (625,14,67,NULL),
    (178,48,100,'2025-07-12'),
    (945,38,77,NULL),
    (621,43,100,'2025-09-24'),
    (253,16,62,NULL),
    (834,4,85,NULL),
    (527,35,100,'2025-11-08'),
    (658,29,76,NULL),
    (381,50,100,'2025-08-10'),
    (923,12,70,NULL),
    (483,42,100,'2025-10-05'),
    (847,34,79,NULL),
    (512,18,68,NULL),
    (671,27,100,'2025-07-21'),
    (316,6,64,NULL),
    (987,45,100,'2025-09-09'),
    (625,49,77,NULL),
    (419,28,100,'2025-11-14'),
    (759,39,71,NULL),
    (518,13,100,'2025-08-23'),
    (782,31,62,NULL),
    (268,36,85,NULL),
    (943,37,100,'2025-10-18'),
    (582,21,75,NULL),
    (421,7,100,'2025-07-13'),
    (874,16,68,NULL),
    (521,40,100,'2025-09-28'),
    (614,3,70,NULL),
    (287,38,100,'2025-11-06'),
    (756,11,79,NULL),
    (459,50,67,NULL),
    (826,20,100,'2025-08-08'),
    (547,46,100,'2025-10-22'),
    (715,44,62,NULL),
    (368,5,100,'2025-07-25'),
    (891,42,77,NULL),
    (537,25,100,'2025-09-12'),
    (624,48,71,NULL),
    (179,14,100,'2025-11-15'),
    (954,17,68,NULL),
    (621,23,100,'2025-08-14'),
    (286,30,79,NULL),
    (769,39,100,'2025-10-09'),
    (428,15,77,NULL),
    (847,45,100,'2025-07-20'),
    (572,29,64,NULL),
    (711,49,100,'2025-09-03'),
    (356,38,85,NULL),
    (925,4,70,NULL),
    (598,43,100,'2025-11-09'),
    (265,37,72,NULL),
    (812,16,100,'2025-08-27'),
    (483,11,68,NULL),
    (754,34,100,'2025-10-17'),
    (417,27,79,NULL),
    (863,28,100,'2025-07-22'),
    (521,6,71,NULL),
    (689,50,100,'2025-09-18'),
    (284,13,62,NULL),
    (947,40,100,'2025-11-13'),
    (632,20,100,'2025-08-06'),
    (392,36,77,NULL),
    (758,31,100,'2025-10-25'),
    (429,42,68,NULL),
    (921,14,100,'2025-07-19'),
    (612,47,100,'2025-09-07'),
    (387,5,76,NULL),
    (876,25,100,'2025-11-12'),
    (548,3,70,NULL),
    (714,49,100,'2025-08-12'),
    (371,18,79,NULL),
    (835,48,100,'2025-10-28'),
    (526,12,67,NULL),
    (693,44,100,'2025-07-17'),
    (419,21,77,NULL),
    (968,40,100,'2025-09-22'),
    (574,15,100,'2025-11-11'),
    (829,16,62,NULL),
    (427,39,100,'2025-08-20'),
    (789,37,71,NULL),
    (217,50,100,'2025-10-14'),
    (921,46,100,'2025-07-23'),
    (583,30,68,NULL),
    (947,43,100,'2025-09-10'),
    (618,4,79,NULL),
    (285,38,100,'2025-11-04'),
    (756,23,76,NULL),
    (512,11,67,NULL),
    (823,36,100,'2025-08-05'),
    (463,20,77,NULL),
    (847,42,100,'2025-10-23'),
    (521,28,100,'2025-07-18'),
    (689,31,70,NULL),
    (267,6,100,'2025-09-16'),
    (754,49,100,'2025-11-02'),
    (428,50,79,NULL),
    (816,21,68,NULL),
    (572,3,100,'2025-08-24'),
    (721,39,100,'2025-10-07'),
    (381,15,62,NULL),
    (912,44,100,'2025-07-29'),
    (574,27,100,'2025-09-04'),
    (251,37,77,NULL),
    (834,34,100,'2025-11-10'),
    (627,16,68,NULL),
    (429,35,100,'2025-08-18'),
    (798,43,71,NULL),
    (519,14,100,'2025-10-11'),
    (654,40,100,'2025-07-26'),
    (392,11,79,NULL),
    (876,50,100,'2025-09-21'),
    (547,25,65,NULL),
    (712,5,100,'2025-11-08'),
    (216,38,100,'2025-08-13'),
    (954,46,77,NULL),
    (621,30,100,'2025-10-19'),
    (297,20,68,NULL),
    (759,49,100,'2025-07-31'),
    (425,48,100,'2025-09-26'),
    (826,3,79,NULL),
    (521,36,100,'2025-11-06'),
    (689,23,70,NULL),
    (372,15,100,'2025-08-02'),
    (847,44,100,'2025-10-15'),
    (536,28,77,NULL),
    (712,47,100,'2025-07-12'),
    (418,39,68,NULL),
    (963,16,100,'2025-09-13'),
    (627,42,62,NULL),
    (489,50,100,'2025-11-09'),
    (784,21,100,'2025-08-21'),
    (267,6,100,'2025-10-01'),
    (758,31,79,NULL),
    (429,45,100,'2025-07-27'),
    (849,4,100,'2025-09-08'),
    (512,37,100,'2025-11-14'),
    (821,27,71,NULL),
    (614,49,100,'2025-08-09'),
    (295,11,68,NULL),
    (765,40,100,'2025-10-24'),
    (521,38,100,'2025-07-22'),
    (876,34,76,NULL),
    (481,13,100,'2025-09-17'),
    (798,20,100,'2025-11-03'),
    (568,43,77,NULL),
    (712,12,70,NULL),
    (251,50,100,'2025-08-19'),
    (947,36,67,NULL),
    (627,25,100,'2025-10-10'),
    (419,15,100,'2025-07-24'),
    (869,23,100,'2025-09-02'),
    (537,30,79,NULL),
    (698,46,100,'2025-11-11'),
    (282,44,68,NULL),
    (756,5,100,'2025-08-16'),
    (429,28,100,'2025-10-29'),
    (816,39,62,NULL),
    (512,7,100,'2025-07-14'),
    (847,49,100,'2025-09-11'),
    (621,3,77,NULL),
    (389,21,100,'2025-11-05'),
    (835,40,70,NULL),
    (574,42,100,'2025-08-12'),
    (318,17,100,'2025-10-06'),
    (954,50,79,NULL),
    (627,48,100,'2025-07-19'),
    (289,38,68,NULL),
    (748,16,100,'2025-09-19'),
    (527,11,77,NULL),
    (689,36,100,'2025-11-13'),
    (371,31,100,'2025-08-07'),
    (912,20,62,NULL),
    (512,45,100,'2025-10-12'),
    (847,6,100,'2025-07-23'),
    (621,43,100,'2025-09-14'),
    (483,39,77,NULL),
    (759,25,100,'2025-11-12'),
    (429,4,70,NULL),
    (876,27,100,'2025-08-22'),
    (582,30,100,'2025-10-09'),
    (718,35,67,NULL),
    (512,50,100,'2025-07-17'),
    (847,15,100,'2025-09-09'),
    (621,49,100,'2025-11-14'),
    (289,37,77,NULL),
    (756,34,100,'2025-08-20'),
    (429,3,68,NULL),
    (816,47,100,'2025-10-28'),
    (521,38,100,'2025-07-29'),
    (876,11,100,'2025-09-23'),
    (574,44,79,NULL),
    (312,21,100,'2025-11-01'),
    (954,40,70,NULL),
    (627,42,100,'2025-08-08'),
    (419,28,100,'2025-10-16'),
    (869,6,100,'2025-07-16'),
    (521,23,100,'2025-09-04'),
    (689,50,77,NULL),
    (368,14,100,'2025-11-10'),
    (823,20,68,NULL),
    (537,39,100,'2025-08-18'),
    (759,5,100,'2025-10-02'),
    (429,48,79,NULL),
    (912,16,100,'2025-07-13'),
    (512,45,100,'2025-09-12'),
    (847,30,100,'2025-11-11'),
    (627,38,77,NULL),
    (582,49,100,'2025-08-31'),
    (812,37,68,NULL)
) AS en([student_id], [course_id], [progress_percentage], [completed_at])
WHERE NOT EXISTS (
    -- Avoid duplicate enrollments
    SELECT 1 FROM [dbo].[StudentCourseEnrollment]
    WHERE [StudentId] = en.[student_id] AND [CourseId] = en.[course_id]
);

-- ============================================================================
-- VERIFICATION
-- ============================================================================

SELECT
    COUNT(*) as [Total Enrollments Inserted],
    COUNT(DISTINCT [StudentId]) as [Unique Students],
    COUNT(DISTINCT [CourseId]) as [Unique Courses],
    AVG([ProgressPercentage]) as [Avg Progress %],
    COUNT(CASE WHEN [Status] = 'completed' THEN 1 END) as [Completed],
    COUNT(CASE WHEN [Status] = 'active' THEN 1 END) as [Active],
    COUNT(CASE WHEN [Status] = 'dropped' THEN 1 END) as [Dropped]
FROM [dbo].[StudentCourseEnrollment];

-- Sample: Show enrollments with completion dates
SELECT TOP 20
    e.[EnrollmentId],
    e.[StudentId],
    c.[Title] as [CourseName],
    e.[ProgressPercentage],
    e.[Status],
    e.[EnrollmentDate],
    e.[CompletionDate]
FROM [dbo].[StudentCourseEnrollment] e
INNER JOIN [dbo].[Course] c ON e.[CourseId] = c.[CourseId]
WHERE e.[Status] = 'completed'
ORDER BY e.[CompletionDate] DESC;

-- Count of enrollments by status
SELECT
    [Status],
    COUNT(*) as [Count],
    AVG([ProgressPercentage]) as [Avg Progress %]
FROM [dbo].[StudentCourseEnrollment]
GROUP BY [Status]
ORDER BY [Count] DESC;
